<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>FütiPicks - Team Points</title>
    <link rel="stylesheet" href="teampts.css">
    <link rel="stylesheet" href="header-temp.css">
    <link rel="icon" type="image/x-icon" href="images/futpicks-logo.png" />
    <script src="https://kit.fontawesome.com/d1f065b276.js" crossorigin="anonymous"></script>
</head>
<body>
    <header>FütiPick's Liga MX Fantasy Football</header>
    <ul id ="navlist">
        <li id="profile"><a href="account.html""></a></li>
        <li id="home"><a href="homepage.html"></a></li>
    </ul>
    <nav id="subHeader">
        <button><a href="homepage.html">Home</a></button>
        <button><a href="fixtures.html">Fixtures</a></button>
        <button class="active"><a href="teampts.html">Points</a></button>
        <button><a href="teampick.html">Pick Team</a></button>
        <button><a href="player_stats.html">Player Stats</a></button>
    </nav>

    <div class="sidebar">
        <button class="league-btn active">LigaMx</button>
        <div class="hudtip">La Liga <span class="hudtext">Coming Soon</span></div>
        <div class="hudtip">Premier League <span class="hudtext">Coming Soon</span></div>
        <div class="hudtip">Bundesliga <span class="hudtext">Coming Soon</span></div>
    </div>

    <img src="images/futpicks-logo.png" alt="background image" class="center-image"/>

    <nav id="pointHeader">
        <div id="pointStyling">
            <p id="averagePoints">54</p>  
            <button id="pointText">Average</button>
        </div>
        <div id="pointStyling">
            <p id="totalPointsCount">0</p> 
            <button id="userPoints">Total Points <i class="arrow right"></i></button>
        </div>
        <div id="pointStyling">
            <p id="highestPoints">100</p>
            <button id="highPoints">Highest <i class="arrow right"></i></button>
        </div>
    </nav>

    <nav id="user-nav">
        <div class="user-points">
            <div id="user-info"></div>
            <h1>LigaMX Fantasy Team</h1>
            <h2>Points</h2>
            <p>Overall Points: 842</p>
            <p>Gameweek Points: 54</p>
        </div>
    </nav>

    <div class="team_container">
        <div class="row">
            <div class="gk_column">
                <div class="player_card" id="gk1" data-position="Goalkeeper">
                    <img
                        src="images/temp_jersey.webp"
                        alt="Jersey"
                        style="width: 70%"
                    />
                    <div class="player_container">
                        <h2><b> 0 pts </b></h2>
                        <p class="player-name">Goalkeeper 1</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="def_column">
                <div class="player_card" id="df1" data-position="Defender">
                    <img
                        src="images/temp_jersey.webp"
                        alt="Jersey"
                        style="width: 70%"
                    />
                    <div class="player_container">
                        <h2><b> 0 pts </b></h2>
                        <p class="player-name">Defender 1</p>
                    </div>
                </div>
                <div class="player_card" id="df2" data-position="Defender">
                    <img
                        src="images/temp_jersey.webp"
                        alt="Jersey"
                        style="width: 70%"
                    />
                    <div class="player_container">
                        <h2><b> 0 pts </b></h2>
                        <p class="player-name">Defender 2</p>
                    </div>
                </div>
                <div class="player_card" id="df3" data-position="Defender">
                    <img
                        src="images/temp_jersey.webp"
                        alt="Jersey"
                        style="width: 70%"
                    />
                    <div class="player_container" data-position="Defender">
                        <h2><b> 0 pts </b></h2>
                        <p class="player-name">Defender 3</p>
                    </div>
                </div>
                <div class="player_card" id="df4" data-position="Defender">
                    <img
                        src="images/temp_jersey.webp"
                        alt="Jersey"
                        style="width: 70%"
                    />
                    <div class="player_container">
                        <h2><b> 0 pts </b></h2>
                        <p class="player-name">Defender 4</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="mid_column">
                <div class="player_card" id="mf1" data-position="Midfielder">
                    <img
                        src="images/temp_jersey.webp"
                        alt="Jersey"
                        style="width: 70%"
                    />
                    <div class="player_container">
                        <h2><b> 0 pts </b></h2>
                        <p class="player-name">Midfielder 1</p>
                    </div>
                </div>
                <div class="player_card" id="mf2" data-position="Midfielder">
                    <img
                        src="images/temp_jersey.webp"
                        alt="Jersey"
                        style="width: 70%"
                    />
                    <div class="player_container">
                        <h2><b> 0 pts </b></h2>
                        <p class="player-name">Midfielder 2</p>
                    </div>
                </div>
                <div class="player_card" id="mf3" data-position="Midfielder">
                    <img
                        src="images/temp_jersey.webp"
                        alt="Jersey"
                        style="width: 70%"
                    />
                    <div class="player_container">
                        <h2><b> 0 pts </b></h2>
                        <p class="player-name">Midfielder 3</p>
                    </div>
                </div>
                <div class="player_card" id="mf4" data-position="Midfielder">
                    <img
                        src="images/temp_jersey.webp"
                        alt="Jersey"
                        style="width: 70%"
                    />
                    <div class="player_container">
                        <h2><b> 0 pts </b></h2>
                        <p class="player-name">Midfielder 4</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="fwd_column">
                <div class="player_card" id="fw1" data-position="Attacker">
                    <img
                        src="images/temp_jersey.webp"
                        alt="Jersey"
                        style="width: 70%"
                    />
                    <div class="player_container">
                        <h2><b> 0 pts </b></h2>
                        <p class="player-name">Forward 1</p>
                    </div>
                </div>
                <div class="player_card" id="fw2" data-position="Attacker">
                    <img
                        src="images/temp_jersey.webp"
                        alt="Jersey"
                        style="width: 70%"
                    />
                    <div class="player_container">
                        <h2><b> 0 pts </b></h2>
                        <p class="player-name">Forward 2</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="reserves_container">
        <div class="row">
            <div class="res_column">
                <div class="player_card" id="res1" data-position="Any">
                    <img
                        src="images/temp_jersey.webp"
                        alt="Jersey"
                        style="width: 70%"
                    />
                    <div class="player_container">
                        <h2><b> 0 pts </b></h2>
                        <p class="player-name">Reserve 1</p>
                    </div>
                </div>
                <div class="player_card" id="res2" data-position="Any">
                    <img
                        src="images/temp_jersey.webp"
                        alt="Jersey"
                        style="width: 70%"
                    />
                    <div class="player_container">
                        <h2><b> 0 pts </b></h2>
                        <p class="player-name">Reserve 2</p>
                    </div>
                </div>
                <div class="player_card" id="res3" data-position="Any">
                    <img
                        src="images/temp_jersey.webp"
                        alt="Jersey"
                        style="width: 70%"
                    />
                    <div class="player_container">
                        <h2><b> 0 pts </b></h2>
                        <p class="player-name">Reserve 3</p>
                    </div>
                </div>
                <div class="player_card" id="res4" data-position="Any">
                    <img
                        src="images/temp_jersey.webp"
                        alt="Jersey"
                        style="width: 70%"
                    />
                    <div class="player_container">
                        <h2><b> 0 pts </b></h2>
                        <p class="player-name">Reserve 4</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footercontainer">
        <div>
            <dl>
                <dt>About</dt>
                <dt><a class="footertext" href="dev-story.html">Our Story</a></dt>
                <dt><a class="footertext" href="contact-us.html">Contact Us</a></dt>
            </dl>
        </div>
        <div>
            <dl>
                <dt>Account</dt>
                <dt><a class="footertext" href="account.html">My Account</a></dt>
                <dt><a class="footertext" href="http://example.com">Reset Password</a></dt>
            </dl>
        </div>
    </div>
    <script src="token.js"></script>
    <script>
        const selectedPlayerIds = new Set();
        let dataLookup = {};

        // Fetch and display the saved team (read-only)
        function loadSavedTeam() {
            fetch("/api/football/my-team", { credentials: "include" })
                .then((res) => res.json())
                .then((data) => {
                    if (!data.players) return;

                    data.players.forEach((p) => {
                        dataLookup[p.player_id] = {
                            id: p.player_id,
                            name: p.name,
                            position: p.position,
                            photo: p.photo,
                            points: p.points,
                            rating: p.rating,
                            team: p.team || "Unknown",
                        };

                        const slotId = getSlotId(p);
                        if (!slotId) {
                            console.warn(
                                "No slot found for:",
                                p.name,
                                "Position:",
                                p.position
                            );
                            return;
                        }

                        const card = document.getElementById(slotId);
                        const img = card.querySelector("img");
                        const nameP = card.querySelector(".player-name");
                        const pointDisplay = card.querySelector("h2 b");

                        if (img) img.src = p.photo || "images/temp_jersey.webp";
                        if (nameP) nameP.textContent = p.name;
                        if (pointDisplay)
                            pointDisplay.textContent = `${p.points || 0} pts`;

                        card.setAttribute("data-player-id", p.player_id);
                        selectedPlayerIds.add(p.player_id);
                    });

                    // Recalculate total points
                    calculateTotalPoints();
                })
                .catch((err) => {
                    console.error("Failed to load team:", err);
                });
        }

    // Calculate total points for header
    function calculateTotalPoints() {
        let totalPoints = 0;

        const allCards = document.querySelectorAll(".player_card");
        allCards.forEach((card) => {
            const pointsText = card.querySelector("h2 b")?.textContent || "0 pts";
            const numericPoints = parseInt(pointsText.replace(" pts", ""), 10) || 0;
            totalPoints += numericPoints;
        });

        // Update the total points display
        const totalPointsElement = document.getElementById("totalPointsCount");
        if (totalPointsElement) {
            totalPointsElement.textContent = totalPoints;
        }

        // Update the highest points if totalPoints exceed 100
        const highestPointsElement = document.getElementById("highestPoints");
        if (highestPointsElement && totalPoints > 100) {
            highestPointsElement.textContent = totalPoints;
        }

        const gameweekPointsElement = document.querySelector(".user-points p:nth-child(5)");
        if (gameweekPointsElement) {
            gameweekPointsElement.textContent = `Gameweek Points: ${totalPoints}`;
        }
    }

    // Disable interactivity on player cards
    function disableCardInteractivity() {
        document.querySelectorAll(".player_card").forEach((card) => {
            card.style.cursor = "default"; // Change cursor to default
            card.onclick = null; // Remove click functionality
            card.oncontextmenu = (e) => e.preventDefault(); // Disable right-click
        });
    }

    // Initializes event listeners and loads saved team on page load
    window.onload = () => {
        loadSavedTeam();
        disableCardInteractivity();
    };

    // Gets the ID of the next empty slot for the player's position
    function getSlotId(p) {
        if (p.is_reserve) {
            for (let i = 1; i <= 4; i++) {
                const card = document.getElementById(`res${i}`);
                if (card && !card.getAttribute("data-player-id")) return card.id;
            }
            return "";
        }

        const map = {
            Goalkeeper: "gk",
            Defender: "df",
            Midfielder: "mf",
            Attacker: "fw",
        };

        const base = map[p.position];
        for (let i = 1; i <= 5; i++) {
            const card = document.getElementById(`${base}${i}`);
            if (card && !card.getAttribute("data-player-id"))
                return `${base}${i}`;
        }
        return "";
    }
</script>
</body>
</html>